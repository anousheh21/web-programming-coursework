<!DOCTYPE html>
<html>

<head>
    <style>
        * {
            box-sizing: border-box;
        }

        table,
        th,
        td {
            border: 1px solid black;
        }

        .container {
            display: flex;
            /* Enables flexbox layout */
        }

        .box {
            flex: 50%;
            padding: 10px;

        }
    </style>

</head>

<body>

    <form id="myForm">
        <label for="country">Choose a country:</label>
        <select id="country" name="countryname">
            <option value="">--Please choose an option--</option>
            <option value="UK">UK</option>
            <option value="US">US</option>
            <option value="China">China</option>
        </select>
    </form>
<br>

    <div class="container">
        <div class="box" id="cyclists"></div>
        <div class="box" id="medals">
            <canvas id="myChart"></canvas>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
    <script>
        let myChart = null;
        document.getElementById('country').addEventListener('change', async function () {
            try {
                
                const selectedCountry = this.value;
                if (selectedCountry == "") {
                    document.getElementById('cyclists').innerHTML = "";
                    clearChart(); // Clear the chart when no country is selected
                }
                else {
                    // Part 1- Asynchronously fetching cyclists data and display data as a table: /////////////////////////////////////////////////////////////////
                    
                    fetch(`cyclists-request.php?countryname=${selectedCountry}`)
                        .then(response => response.json())
                        .then(responseData => {
                            let len = responseData.length
                            let insertedHtml = "<table border=1>"
                            insertedHtml += "<tr><th>Number</th><th>Name</th><th>DOB</th></tr>"
                            for(let i = 0; i<len; i++) {
                                let cyclistsName = responseData[i].name
                                let cyclistsDob = responseData[i].dob
                                insertedHtml += "<tr>" +
                                    "<td align='center'>" + (i+1) + "</td>" +
                                    "<td align='center'>" + cyclistsName + "</td>" +
                                    "<td align='center'>" + cyclistsDob + "</td>" +
                                    "</tr>";
                            }
                            insertedHtml += "</table>"
                            document.getElementById("cyclists").innerHTML = insertedHtml
                        })

                        fetch(`medals-request-template.php?countryname=${selectedCountry}`)
                        .then(response => response.json())
                        .then(responseData => {
                            let len = responseData.length
                            let insertedHtml = "<table border=1>"
                            // insertedHtml += "<tr><th>Number</th><th>Name</th><th>DOB</th></tr>"
                            for(let i = 0; i<len; i++) {
                                let gold = responseData[i].gold
                                let silver = responseData[i].silver
                                let bronze = responseData[i].bronze
                                insertedHtml += "<tr>" +
                                    "<td align='center'>" + (i+1) + "</td>" +
                                    "<td align='center'>" + gold + "</td>" +
                                    "<td align='center'>" + silver + "</td>" +
                                    "</tr>";
                            }
                            insertedHtml += "</table>"
                            document.getElementById("medals").innerHTML = insertedHtml
                        })


                    // Part 2- Asynchronously fetching medal data and visualise it using chart: /////////////////////////////////////////////////////////////////
                    // fetch(`medals-request-template.php?countryname=${selectedCountry}`)
                    //     .then(response => response.json())
                    //     .then(responsedata => {
                    //         let len = responseData.length
                    //         let insertedHtml = "<table border=1>"
                    //         insertedHtml += "<tr><th>Number</th><th>Name</th><th>DOB</th></tr>"
                    //         for(let i = 0; i<len; i++) {
                    //             let gold = responseData[i].gold
                    //             let silver = responseData[i].silver
                    //             let bronze = responseData[i].bronze
                    //             insertedHtml += "<tr>" +
                    //                 "<td align='center'>" + (i+1) + "</td>" +
                    //                 "<td align='center'>" + gold + "</td>" +
                    //                 "<td align='center'>" + silver + "</td>" +
                    //                 "<td align='center'>" + bronze + "</td>" +
                    //                 "</tr>";
                    //         }
                    //         insertedHtml += "</table>"
                    //         console.log(insertedHtml)
                    //         document.getElementById("medals").innerHTML = insertedHtml
                    //     })
                    





                    // updateVisual(responseMedalsData); // responseMedalsData is an array containing JSON objects that resulted from calling .json() method
                }
            }
            catch (error) {
                console.log('Error:', error);
            }

        });

        function updateVisual(medalsData) {
            
            //Part 3: Insert write values into labels and values
            const labels = []; 
            const values = [];
            
            const palette = [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
            ];
       
       
            // Get the canvas element
            const myCanvas = document.getElementById('myChart');

            // Clear the previous chart instance
            clearChart();

            // Create a new chart instance
            myChart = new Chart(myCanvas, {

                type: "bar",
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Medals',
                        data: values,
                        backgroundColor: palette,
                        borderColor: 'rgba(0, 0, 0, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    legend: { display: false },
                    title: {
                        display: true,
                        text: "Medals"
                    }
                }
            });
        }

        // Function to clear the chart
        function clearChart() {
            if (myChart !== undefined && myChart !== null) {
                myChart.destroy();
                myChart = null; // Reset the myChart variable after destroying
            }
        }
    </script>

</body>

</html>